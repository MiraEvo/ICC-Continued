# 墨迹书写逻辑优化计划

## 实施步骤（每个阶段完成后会 commit）

### Phase 1: 创建新的 InkEngine 服务层
创建现代化的墨迹引擎服务，统一处理笔画数据、渲染和识别。

**新建文件**:
- `Services/Ink/IInkEngine.cs` - 引擎接口
- `Services/Ink/InkEngine.cs` - 核心实现
- `Services/Ink/InkStrokeData.cs` - 笔画数据模型
- `Services/Ink/InkRenderContext.cs` - 渲染上下文

### Phase 2: 优化渲染管线
优化 InkStrokesOverlay 和 InkCompositor，引入双缓冲机制。

**修改文件**:
- `Helpers/InkStrokesOverlay.cs`
- `Helpers/InkCompositor.cs`

### Phase 3: 重构形状识别
优化 InkRecognizeHelper，改进异步处理和缓存机制。

**修改文件**:
- `Helpers/InkRecognizeHelper.cs`
- `MainWindow.Partials/Features/MainWindow.SimulatePressureAndInkToShape.cs`

### Phase 4: 改进代码质量
移除反射调用，使用现代 C# 特性。

**修改文件**:
- `MainWindow.Partials/UI/MainWindow.InkCanvas.cs`

### Phase 5: 测试和微调
性能测试和最终调整。

---

请确认后开始 Phase 1 的实施。