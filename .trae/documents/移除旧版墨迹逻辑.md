# 移除旧版墨迹逻辑计划

## 需要移除/替换的旧版组件

### 1. 旧版类定义（直接删除）
- **MainWindow.InkCanvas.cs** 中的 `IccStroke` 类（第30-232行）
- **MainWindow.InkCanvas.cs** 中的 `IccInkCanvas` 类（第234-278行）

### 2. XAML 更新
- **MainWindow.xaml** 第159行：将 `<inkCanvas:IccInkCanvas>` 改为 `<inkCanvas:IccInkCanvasModern>`

### 3. 代码文件更新

#### MainWindow.InkCanvas.cs
- 保留文件但清空内容或删除（因为新版在 .Refactored.cs 中）

#### InkCanvasService.cs
- 第15行：更改字段类型 `IccInkCanvas` → `IccInkCanvasModern`
- 第22行：更新构造函数参数
- 第79行：更新属性返回类型

#### MainWindow.TimeMachine.cs
- 第42行：更新方法参数类型
- 第128行：更新实例化代码

#### MainWindow.SimulatePressureAndInkToShape.cs
- 第44、56行：将 `InkRecognizeHelper.RecognizeShapeAsync` 改为使用 `InkRecognitionPipeline`

#### MainWindow.xaml.cs
- 第1280行：将 `InkRecognizeHelper.PreloadAsync()` 改为 `inkEngine.PreloadAsync()`

### 4. 保留的文件（新版已存在）
- ✅ MainWindow.InkCanvas.Refactored.cs（包含新版 IccStrokeModern 和 IccInkCanvasModern）
- ✅ Services/Ink/ 目录下的所有新服务

### 5. 可选：保留 InkRecognizeHelper 作为兼容层
- 可以保留旧版 InkRecognizeHelper 作为适配器，内部调用新的 InkRecognitionPipeline
- 这样可以减少对 MainWindow.SimulatePressureAndInkToShape.cs 的改动

## 实施步骤

1. **更新 XAML** - 替换 IccInkCanvas 为 IccInkCanvasModern
2. **更新 InkCanvasService** - 使用新版画布类型
3. **更新 TimeMachine** - 使用新版画布类型
4. **删除旧版类定义** - 从 MainWindow.InkCanvas.cs 中移除旧类
5. **更新形状识别调用** - 迁移到新的 InkRecognitionPipeline
6. **构建测试** - 确保没有编译错误

## 风险评估

| 风险 | 缓解措施 |
|------|----------|
| 功能回归 | 逐步替换，每次替换后测试 |
| XAML 设计器不识别 | 确保命名空间和类名正确 |
| 事件绑定失效 | 检查所有事件处理器是否正确连接 |

请确认后开始实施。